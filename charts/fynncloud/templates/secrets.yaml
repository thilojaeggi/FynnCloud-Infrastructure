{{/*
Only create the chart-managed secret when:
- CNPG is disabled AND
  no existingSecret is specified for external postgresql, OR
- No existingSecret is specified for the backend (JWT secret)
CNPG automatically manages its own secrets ("-app").
*/}}
{{- $needsPostgresSecret := and (not .Values.cnpg.enabled) (not .Values.externalPostgresql.existingSecret) .Values.externalPostgresql.password }}
{{- $needsJwtSecret := not .Values.backend.existingSecret }}
{{- if or $needsPostgresSecret $needsJwtSecret }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "fynncloud.fullname" . }}-secrets
  labels:
    {{- include "fynncloud.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if $needsPostgresSecret }}
  postgres-password: {{ .Values.externalPostgresql.password | b64enc | quote }}
  {{- end }}
  {{- if $needsJwtSecret }}
  jwt-secret: {{ .Values.backend.env.JWT_SECRET | b64enc | quote }}
  {{- end }}
{{- end }}
